<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM ì˜ë¥˜ ì¶”ì²œ ì‹œìŠ¤í…œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, sans-serif;
    }

    .container {
      min-height: 100vh;
      padding: 0 10%;
      display: flex;
      flex-direction: column;
    }

    header {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 2rem 0 0;
      gap: 500px;
    }

    footer {
      width: 100%;
      text-align: center;
      padding: 20px;
      background-color: #f8f8f8;
      color: #666;
      font-size: 14px;
      margin-top: 30px;
      border-top: 1px solid #ddd;
    }

    .logo-image {
      width: 60px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .notice {
      font-size: 1rem;
    }

    .auth-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: normal;
      cursor: pointer;
    }

    .btn-ghost {
      background: transparent;
    }

    .btn-ghost:hover {
      background: transparent;
    }

    .btn-black {
      background-color: #ff4a48;
      color: white;
      padding: 0.5rem 1rem;
    }

    .btn-black:hover {
      background-color: #f5ae79;
    }

    .btn-outline {
      border: 1px solid #E5E7EB;
      background: transparent;
      height: 48px;
      flex: 1;
    }

    .btn-outline:hover {
      border-color: #D1D5DB;
    }

    main {
      flex-grow: 1;
      display: flex;
      margin-top: 2rem;
    }

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .title {
      font-size: 32px;
      font-weight: normal;
      color: #1a1a1a;
      font-size: 42px;
      font-weight: 700;
    }
    .sub-title {
      margin-bottom: 3rem;
      font-weight: 500;
    }

    .example-prompts {
      width: 100%;
      max-width: 768px;
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .input-form {
      width: 100%;
      max-width: 768px;
    }

    .input-group {
      display: flex;
      gap: 0.5rem;
    }

    .input-text {
      flex-grow: 1;
      height: 48px;
      padding: 0.5rem 1rem;
      border: 1px solid #E5E7EB;
      border-radius: 0.5rem;
      font-size: 1rem;
    }

    .recommendation {
      width: 100%;
      max-width: 768px;
      margin-top: 1.5rem;
      padding: 1rem;
      background-color: #E5E7EB;
      border-radius: 0.5rem;
    }

    .recommendation-item {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      background: white;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease-in-out;
    }

    .recommendation-item:hover {
      transform: translateY(-5px);
    }

    .product-image {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
    }

    .product-info {
      flex: 1;
    }

    .product-info h3 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }

    .product-info p {
      margin: 5px 0;
      font-size: 14px;
      color: #666;
    }

    .recommendation-reason {
      font-style: italic;
      color: #444;
    }

    .view-product {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 15px;
      background-color: black;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s;
    }

    .view-product:hover {
      background-color: #333;
    }

    .ad-section {
      width: 200px;
      height: 400px;
      position: relative;
      overflow: hidden;
    }

    .ad-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      transition: opacity 1s ease-in-out, transform 1s ease-in-out;
    }

    .fade-out {
      opacity: 0;
      transform: rotate(360deg) scale(0.5);
    }

    .fade-in {
      opacity: 1;
      transform: rotate(0deg) scale(1);
    }

    /* ì „ì²´ í™”ë©´ ë®ëŠ” ë°˜íˆ¬ëª… ë ˆì´ì–´ */
    #loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª… ê²€ì€ìƒ‰ */
      backdrop-filter: blur(5px); /* ë¸”ëŸ¬ íš¨ê³¼ */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000; /* ë‹¤ë¥¸ ìš”ì†Œë³´ë‹¤ ìœ„ */
    }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top: 5px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    /* ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<header>
  <div class="logo">
    <a href="/"><img class="logo-image" src="/img/kp.png"></a>
  </div>
  <div class="header-right">
    <div class="auth-buttons">
      <a href="/notice"><button class="btn btn-ghost">Notice</button></a>
      <a href="/login"><button class="btn btn-ghost">Sign In</button></a>
      <a href="/register"><button class="btn btn-black">Sign Up</button></a>
    </div>
  </div>
</header>
<div class="container">
  <main>
    <div class="content">
      <h1 class="title">ë‚˜ë§Œì˜ ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸</h1>
      <h3 class="sub-title">íŒ¨ì…˜ ì¶”ì²œ ì‹œìŠ¤í…œ</h3>
      <form class="input-form" id="promptForm">
        <div class="input-group">
          <input type="text" class="input-text" id="promptInput" placeholder="ì˜ë¥˜ ì¶”ì²œì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
          <input type="hidden" id="gender" value="female">
          <button type="submit" class="btn recommendation-button btn-black" style="width: 112px;">ì¶”ì²œë°›ê¸°</button>
        </div>
      </form>
      <div class="example-prompts" id="examplePrompts">
        <!-- JavaScript will populate this -->
      </div>
      <div class="recommendation" id="recommendation" style="display: none;">
        <!-- JavaScript will populate this -->
      </div>
    </div>
    <div class="ad-section">
      <a id="ad-link" href="https://spao.com/" target="_blank">
        <img id="ad-img" class="ad-image fade-in" src="https://spao.com/web/upload/category/shop1_5759_top_873043.png" alt="ê´‘ê³  ì´ë¯¸ì§€">
      </a>
    </div>
  </main>
</div>
<footer class="footer">
  <p>&copy; 2025 LLM ì˜ë¥˜ ì¶”ì²œ ì‹œìŠ¤í…œ. All rights reserved.</p>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  const ads = [
    { img: "https://spao.com/web/upload/category/shop1_5759_top_873043.png", url: "https://spao.com/" },
    { img: "https://spao.com/web/upload/free_design/20250110/20250122_luckybox_pc.jpg", url: "https://spao.com/" },
    { img: "/img/spao3.png", url: "https://spao.com/" },
  ];

  let currentIndex = 0;
  const adImg = document.getElementById("ad-img");
  const adLink = document.getElementById("ad-link");

  function changeAd() {
    adImg.classList.remove("fade-in");
    adImg.classList.add("fade-out");

    setTimeout(() => {
      currentIndex = (currentIndex + 1) % ads.length;
      adImg.src = ads[currentIndex].img;
      adLink.href = ads[currentIndex].url;

      adImg.classList.remove("fade-out");
      adImg.classList.add("fade-in");
    }, 1000);
  }

  setInterval(changeAd, 5000); // 3ì´ˆë§ˆë‹¤ ê´‘ê³  ë³€ê²½

  const examplePrompts = [
    "ê²°í˜¼ì‹ì— ì…ê³  ê°ˆ ì˜·ì„ ì¶”ì²œí•´ ì¤˜",
    "ì—¬ë¦„ í•´ë³€ ì—¬í–‰ìš© ì˜·ì„ ì¶”ì²œí•´ ì¤˜",
    "íšŒì‚¬ ë©´ì ‘ìš© ì •ì¥ì„ ì¶”ì²œí•´ ì¤˜"
  ];

  // Populate example prompts
  const promptsContainer = document.getElementById('examplePrompts');
  examplePrompts.forEach(prompt => {
    const button = document.createElement('button');
    button.className = 'btn btn-outline';
    button.textContent = prompt;
    button.onclick = () => {
      document.getElementById('promptInput').value = prompt;
    };
    promptsContainer.appendChild(button);
  });

  // Handle form submission
  document.getElementById('promptForm').onsubmit = async (e) => {
    e.preventDefault();

    const form = document.getElementById('promptForm');
    const promptInputValue = document.getElementById('promptInput').value.trim();
    const recommendButton = document.querySelector(".recommendation-button");
    const loadingOverlay = document.getElementById("loading-overlay"); // ë¡œë”© ë ˆì´ì–´

    if (!promptInputValue) {
      alert("í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      return;
    }

    // ğŸ”’ ë²„íŠ¼ ë¹„í™œì„±í™” & ë¡œë”© ë ˆì´ì–´ í‘œì‹œ
    recommendButton.disabled = true;
    recommendButton.textContent = "ì¶”ì²œ ì¤‘..."; // ë¡œë”© ìƒíƒœ í‘œ
    loadingOverlay.style.display = "flex"; // ë¡œë”© ë ˆì´ì–´ í™œì„±í™”

    const formData = new FormData(form);
    formData.append("gender", document.getElementById("gender").value);
    formData.append("promptInput", promptInputValue);

    const jsonObject = Object.fromEntries(formData.entries());
    const recommendationDiv = document.getElementById('recommendation');

    try {
      const response = await fetch('http://127.0.0.1:8000/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(jsonObject)
      });

      if (!response.ok) {
        throw new Error("ì„œë²„ ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }

      const data = await response.json();
      console.log('Raw Response:', data);

      // âœ… JSON ë°ì´í„° íŒŒì‹±
      let responseData;
      try {
        responseData = typeof data.response === "string" ? JSON.parse(data.response) : data.response;
        console.log("Parsed Response Data:", responseData);
      } catch (error) {
        console.error("JSON Parsing Error:", error);
        recommendationDiv.textContent = "JSON ë°ì´í„° ë³€í™˜ ì˜¤ë¥˜";
        return;
      }

      const recommendations = responseData.recommendation || responseData.recommendations;

      if (!recommendations || recommendations.length === 0) {
        throw new Error("ì¶”ì²œ ê²°ê³¼ ì—†ìŒ");
      }

      // ğŸ›  ê¸°ì¡´ ì¶”ì²œ ê²°ê³¼ ì´ˆê¸°í™”
      recommendationDiv.innerHTML = "";

      // ğŸ›  ì¶”ì²œ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ HTMLë¡œ ë³€í™˜í•˜ì—¬ ì¶”ê°€
      recommendations.forEach(item => {
        // language=HTML
        const itemHTML = `
                <a href="${item.url}" style="text-decoration:none;" target="_blank">
                  <div class="recommendation-item">
                    <img src="${item.image}" alt="${item.title}" class="product-image">
                    <div class="product-info">
                        <h3>${item.title}</h3>
                        <p><strong>ê°€ê²©:</strong> ${item.price.toLocaleString()}ì›</p>
                        <p><strong>ìƒ‰ìƒ:</strong> ${item.color}</p>
                        <p><strong>ì‚¬ì´ì¦ˆ:</strong> ${item.size}</p>
                        <p><strong>ì†Œì¬:</strong> ${item.material}</p>
                        <p class="recommendation-reason"><strong>ì¶”ì²œ ì´ìœ :</strong> ${item.reason}</p>
                    </div>
                  </div>
                </a>`;
        recommendationDiv.innerHTML += itemHTML;
      });

      // ğŸ›  ì¶”ì²œ ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œ
      recommendationDiv.style.display = 'block';

    } catch (error) {
      console.error('Error:', error);
      recommendationDiv.innerHTML = '<p>ì¶”ì²œ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
      recommendationDiv.style.display = 'block';
    } finally {
      // âœ… ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
      recommendButton.disabled = false;
      recommendButton.textContent = "ì¶”ì²œë°›ê¸°";
      loadingOverlay.style.display = "none"; // ë¡œë”© ë ˆì´ì–´ ìˆ¨ê¸°ê¸°
    }
  };

</script>
<div id="loading-overlay" style="display: none;">
  <div class="loading-spinner"></div>
</div>
</body>
</html>